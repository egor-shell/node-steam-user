# SteamUser
Библиотека SteamUser позволяет вам взаимодействовать с серверами Steam также как и Steam-клиент. Библиотека содержит все функции, которые встречаются в Steam-клиенте.

## Установка
Установка с помощью [npm](https://www.npmjs.com/package/steam-user):
```sh
$ npm install steam-user
```

## Содержание
* Паттерны
* Перечисления (Enums)
* Статистические методы
* Опции
* Свойства
* Методы
* События  
Некоторая документация к библиотеке, чаще всего по экспериментальным функциям (но, не только), находится на [GitHubWiki](https://github.com/DoctorMcKay/node-steam-user/wiki)

## Паттерны
Существует ряд шаблонов кодинга, которые повторяются во всей библиотеке SteamUser. Рекомендуется прочитать данный раздел для дальнейшей работы с библиотекой.
### Коллбэки и промисы
Все методы библиотеки, которые принимают коллбэк (callback), возвращают промис.  
Унаследованные коллбэки возвращают свои данные, охватывающие несколько аргументов. Все промисы (возвращаюище любые данные) возвращают один объект, содержащий одно или несколько свойств. Имена этих свойств для коллбэков - это имена аргументов коллбэка, перечисленные в README.  
Методы указывают на то обязательны коллбэки или нет. **Вам никогда не требуется использовать коллбэк вместо промисов**, но если коллбэк не указан как обязательный, то необработанный промис не вызовет *предупреждения* или *ошибки*. Если же наоборот, коллбэк указан как обязательный, то необработанный промис вызовет *предупреждении* и в конечном итоге приведёт к *ошибке*.
## Перечисления (Enums)
В Steam используется множество перечислений. Все они доступны в библиотеке SteamUser.  
Все перечисления можно посмотреть на [GitHub](https://github.com/DoctorMcKay/node-steam-user/tree/master/enums).  
Кроме того, для удобства, значение перечисления доступно из глобальной переменной **SteamUser**. Пример:
```sh
Нам нужно вызвать перечисление валют. Это можно сделать с помощью:
SteamUser.ECurrencyCode – дальше IDE предложит перечисления известных валют по ключу ECurrencyCode
```
## Статистические методы
Статистические методы или функции, прикреплённые напрямую к `SteamUser`, вызываются с помощью корневого модуля *(SteamUser)*, а не через обработчик.
###formatCurrency(amount, currency) – функция для определения валюты.  
* `amount` – Сумма
* `currency` – Валюта. Выбирается с помощью перечисления `ECurrencyCode`  
Форматирует значение валюты и возвращает строку. Пример:
```javascript
console.log(SteamUser.formatCurrency(12.34, SteamUser.ECurrencyCode.USD)); // $12.34
console.log(SteamUser.formatCurrency(12345, SteamUser.ECurrencyCode.JPY)); // � 12345
console.log(SteamUser.formatCurrency(123.45, SteamUser.ECurrencyCode.EUR)); // 123,45�
```
## Опции
Существует ряд опций способный управлять поведением библиотеки. 
### dataDirectory (каталог данных)
Определяет куда записываются списки серверов Steam и sentry файлов. Если данные равны **null**, данные не будут сохраняться.  
Для каждой платформы используется свой каталог данных:
* В Windows – это `%localappdata%\doctormckay\node-steamuser`
* В Mac – это `~/Library/Application Support/node-steamuser`
* В Linux – это `$XDG_DATA_HOME/node-steamuser`, или `~/.local/share/node-steamuser` если `$XDG_DATA_HOME` не определён или пуст.
### autoRelogin
Boolean-значение определяющее, будет ли библиотека автоматически переподключаться к Steam из-за его сбоя.  
По-умолчанию – `true`.
### singleSentryfile
Boolean-значение определяющее, будет ли библиотека использовать один Sentry-файл для всех учётных записей.  
Если `false`, тогда для каждой учётной записи будет создан файл с именем `sentry.accountname.bin`. Если `true`, тогда для всех учётных записей будет использоваться файл с именем `sentry.bin`.  
По-умолчанию – `false`.
`ДАННЫЙ РАЗДЕЛ ПОКА НЕ ДОПИСАН. ИСПРАВИТСЯ В СКОРОМ ВРЕМЕНИ.`
## Свойства
### steamID
`null`, если он нет входа в Steam, иначе он содержит steamID учётной записи Steam.
### options
Объект содержащий параметры для библиотеки SteamUser. **Read-only**; для изменения параметров необходимо использовать: `setOption` или `setOptions`.
### vanityURL
Определяется только если произведён вход в аккаунт Steam. Это Ваш URL адрес (часть, которая идёт после `/id/` в URL-адресек профиля).
### accountInfo
Объект содержащий информацию о Вашей учётной записи. Значение будет `null`, пока не будет вызвано событие `accountInfo`. 
* `name` – имя Вашего Steam-аккаунта.
* `country` – страна из которой Вы вошли в Steam-аккаунт.
* `authedMachines` – сколько устройств подключенно к аккаунту с помощью Steam-Guard.
* `flags` – битовые флаги аккаунта.
* `facebookID` – ваш ID аккаунта Facebook, если аккаунт Steam привязан к Facebook.
* `facebookName` – ваше (реальное) имя на Facebook, если аккаунт Steam привязан к Facebook.
### emailInfo
Объект содержащий информацию, об **email** привязанный к аккаунту Steam. Значение будет `null`, пока не будет вызвано событие `emailInfo`.
* `address` – Ваш **email**.
* `validated` – `true`, если **email** подтверждён, `false`, если нет.
### limitations
Объект содержащий информацию, об ограничениях Вашей учётной записи Steam. Значение `null`, до тех пор, пока не будет вызвано событие `accountLimitations`.
* `limited` – `true`, если аккаунт имеет ограничения. `false`, если нет.
* `communityBanned` – `true`, если аккаунт заблокирован в сообществе Steam. `false`, если нет.
* `locked` – `true`, если аккаунт заблокирован. `false`, если нет.
* `canInviteFriends` – `true`, если есть вохможность добавлять друзей. `false`, если нет.
### vac
Объект содержащий информацию, о **VAC-банах** Вашей учётной записи. Значение `null`, до тех пор, пока не будет вызвано событие `vacBans`.
* `numBans` – количество банов на аккаунте.
* `appids` – массив содержащий AppIDs (ID приложений) к которым Вам запрещён доступ. 
### wallet
Объект содержащий информацию, о Вашем Steam-кошельке. Значение `null`, до тех пор, пока не будет вызвано событие `wallet`.
* `hasWallet` – `true`, если у Вас есть Steam-кошелёк. `false`, если нет.
* `currency` – ID валюты Вашего кошелька. (Список валют можно узнать вызвав `SteamUser.ECurrencyCode`).
* `balance` – баланс Вашего кошелька.
### licenses
Массив содержащий данные приложений Вашего аккаунта. Значение `null`, до тех пор, пока не будет вызвано событие `licenses`.
### gifts
Массив содержащий данные о подарках не принятых Вами (в свою библиотеку или инвентарь). Значение `null`, до тех пор, пока не будет вызвано событие `gifts`.
* `gid` – ID подарка в виде строки (64-битное число).
* `packageId` – ID пакета которая будет предоставлена подарком.
* `TimeCreated` – `Date`-объект, содержащий информацию о дате приобритения подарка.
* `TimeExpiration` – `Date`-объект, содержащий информацию о дате истечения подарочного пропуска.
* `TimeSent` – `Date`-объект, содержащий информацию о дате отправки подарка Вам.
* `TimeAsked` – то же самое, что и `TimeSent`.
* `TimeRedeemed` – всегда равно `null`.
* `ReciopientAddress` – всегда пустая строка.
* `SenderAddress` – всегда пустая строка.
* `SenderName` – Steam-логин пользователя отправившего подарок.
### users
Объект содержащий данные о всех пользователях Steam, с которыми вы сталкивались или запрашивали данные. Ключи - это 64-битные SteamIDs, а значение такие же как у объекта полученные при вызове события `user`.  
Свойство не может быть обновлено в режиме онлайн.
### groups
Объект содержащий данные о всех группах Steam, с которыми вы сталкивались или запрашивали данные. Ключи - это 64-битные SteamIDs, а значение такие же как у объекта полученные при вызове события `group`.  
Свойство не может быть обновлено в режиме онлайн.
### chats
Объект содержащий информацию обо всех чатах аккаунта. Ключи - это 64-битные SteamIDs, а значения имеют следующую структуру:
* `name` – название чата или пустая строка, если чат многопользовательский. 
* `private` – `true`, если только члены группы могут приглашать пользователей. `false`, если чат открыт для всех.
* `officersOnlyChat` – `true`, если только модераторы чата могут общаться. `false`, если могут все.
* `unjoinable` – `true`, если к чату нельзя присоединиться. `false`, если можно.
* `members` – объект содержащий ключи (64-битные SteamIDs) пользователей чата и объекты значений со следующей структурой:
    * `rank` – значение из `EClanRank`.
    * `permissions` – битовая строка со значением из `EChatPermission`, содержащая права пользователя в чате.
### myFriends
Объект содержащий ключи (64-битные SteamIDs) и значения, явялющиеся значениями из `EFriendRelationship`  
Когда мы перестаём дружить, ключ полностью удаляется из объекта.
Не будет иметь значения до тех пор, пока не будет вызвано событие `friendsList`.
### myGroups
Объект содержащий ключи (64-битные SteamIDs) и значения, являющиеся значениями из `EClanRelationship`. Предоставляет возможность определить в каких группах вы находитесь.   
Когда вы покидаете группу, ключ полностью удаляется из объекта.  
Не будет иметь значения до тех пор, пока не будет вызвано событие `groupList`.
### myFrienGroups
**Для использования этого свойства, требуется версия 1.10.0 или позже**
Объект содержащий ваши группы друзей (в Steam-клиенте они называются тэгами). Ключи - числовые ID групп и следующие объекты:
* `name` – строка с названием группы.
* `members` – массив, содержащий SteamID членов группы.
### myNicknames
**Для использования этого свойства, требуется версия 3.15.0 или позже**
Объект содержащий ники, которые Вы присваивали другим пользователям. Ключи - SteamID, свойства - ник пользователя.  
Не будет иметь значения до тех пор, пока не будет вызвано событие `nicknameList`.
### picsCache
**Для использования этого свойства, требуется версия 3.3.0 или позже**
Объект содержащий кэшированные данные о Ваших приложениях. Используется только если `enablePicsCache` имеет значение `true`.
* `changenumber` – последний известный номер изменения.
* `apps` – объект, ключи которого это AppIDs, а значения это объекты идентичные тем, которые возвращаются при вызове `getProductInfo`.
* `package` – объект, ключи которого это PackageIDs, а значения это объекты идентичные тем, которые возвращаются при вызове `getProductInfo`.
### chat
**Для использования этого свойства, требуется версия 4.0.0 или позже**
Это экземпляр `SteamChatRoomClient`. Этот объект следует использовать для общения с друзьями в чате.
[Документация SteamChatClient](https://github.com/DoctorMcKay/node-steam-user/wiki/SteamChatRoomClient)
### packageName
**Для использования этого свойства, требуется версия 4.2.0 или позже**
Содержит имя этой библиотеки. Значение всегда `"steam-user"`. Позволяет другим модулям проверять совместимость.
### packageVersion
**Для использования этого свойства, требуется версия 4.2.0 или позже**
Содержит версию этой библиотеки. Например `"4.2.0"`. Позволяет другим модулям проверять совместимость.
## Методы
### Constructor(options)
* `options` – необязательный объект, содержащий нуль или более параметров, которые можно установить для библиотеки `SteanUser`.
Создаёт новый экземпляр `SteamUser`.
### setOption(option, value)
* `option` – название параметра.
* `value` – значение для устанавлеваемого параметра.
### logOn([details])
* `details` – объект содержащий данные для входа в Steam-аккаунт.
    * `accountName` – имя учётной записи.
    * `password` – пароль учётной записи.
    * `loginKey` – ключ для входа.
    * `webLogonToken` – токен для входа.
    * `steamID` – при входе с токеном, следует прилагать SteamID.
    * `authCode` – если присутсвует код SteamGuard из e-mail, следует указать его здесь.
    * `twoFactorCode` – если присутсвует код SteamGuard из мобильного приложения SteamGuard, следует указать его здесь.
    * `rememberPassword` – значение `true`, если вы хотите получить ключ для входа, который можно будет использовать вместо пароля для следующего входа в систему. `false`, если нет.
    * `logonID` – 32-битное число для идентификации входа.
    * `machineName` – строка содержащая имя компьютера с которого производится вход в Steam-аккаунт.
    * `clientOS` – номер ОС. Обнаруживается автоматически, если явно не указан.
    * `dontRememberMachine` – если предоставляете `authCode`, но не хотите, чтобы Steam запоминал `sentryfile`, следует передать в этом поле `true`.
### logOff()
Выходит с учётной записи Steam, закрывая соединение.
### getPlayerCount(appid, callback)
* `appid` – AppID приложения, для которого нужно текущее кол-во игроков (для получения всех зарегестрированных в Steam пользователей, следует использовать `0`).
* `callback` – вызывается, когда запрошенные данные доступны.
    * `err` – объект `Error` в случае ошибки или `null` в случае успеха.
    * `playerCount` – запрашиваемое количество пользователей.
### removeFriend(steamID)
* `steamID` – steamID пользователя, которого вы хотите удалить из друзей.
### createQuickInviteLink([options,] callback)
* `options` – по желанию. Объект содержащий нуль или более этих свойств:
    * `inviteLimit` – сколько раз можно использовать ссылку, прежде чем она станет недействительной. По-умолчанию **1**.
    * `inviteDuration` – как долго (в секундах) по времени ссылка будет действительна. По-умолчанию `null`.
* `callback` – вызывается при завершении запроса:
  * `err` – объект `Error` в случае ошибки или `null` в случае успеха.
  * `response` – ответ:
      * `token` – объект с этими свойствами:
        * `invite_link` – ссылка, с помощью которой можно напрямую добавить Вас в друзья.
        * `invite_token` – токен, часть ссылки.
        * `invite_limit` – количество переходов по ссылке, прежде чем она станет недействительной.
        * `invite_duration` – как долго (в секундах) по времени ссылка будет действительна. `null`, если она не исчезнет.
        * `time_created` – объект `Date`, показывающий когда ссылка была создана.
        * `valid` – `true`, если ссылка действительна. `false`, если нет.

Создаёт инвайт-ссылку, которую можно использовать для добавления вас в друзья. Без необходимости отправки приглашения в друзья, которое требует утверждения. 
